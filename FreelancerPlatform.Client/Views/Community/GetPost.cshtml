@using FreelancerPlatform.Application.Extendsions
@model FreelancerPlatform.Application.Dtos.Post.PostViewModel

@{
    ViewData["Title"] = "Chi tiết bài đăng";
}

<input id="post-id" value="@Model.Id" type="hidden" />
<input id="freelancer-id" value="@User.GetUserId()"  type="hidden" />


<div class="posts-container" style="display: block; width: 100%; max-width: 1200px; margin: auto; padding-top: 20px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); border-radius: 10px; overflow: hidden;">

   

        <!-- Freelancer List Section -->
        <div style="width: 100%; padding: 20px;" id="freelancer-list">
            <div class="profile-header" style="display: flex; align-items: flex-start; margin-bottom: 20px;">
                <div class="profile-info" style="flex-grow: 1;">
                    <!-- Tên công việc -->
                    <h1 style="font-size: 24px; margin: 0;">
                        @Model.Title
                        <span id="container-status-job">
                            <span style="font-size: 12px; color: gray; margin-left: 10px;">
                                @((int)((DateTime.Now - Model.CreateDay)).TotalDays)
                                ngày trước
                            </span>
                        </span>

                    </h1>
                </div>

                <!-- Icons section -->
                @{
                if (Model.FreelancerId == User.GetUserId())
                {
                    <button data-post="@Model.Id" class="btn-edit-post" style="background-color: transparent; border: none; padding: 10px; border-radius: 5px; font-size: 1em; cursor: pointer; color: inherit;" title="Chỉnh bài đăng">
                        <i class="fa fa-pen" style="font-size: 1.2em;"></i>
                    </button>
                    <button data-post="@Model.Id" class="btn-delete-post" style="background-color: transparent; border: none; padding: 10px; border-radius: 5px; font-size: 1em; cursor: pointer; color: inherit;" title="Xoá bài đăng">
                        <i class="fa fa-trash" style="font-size: 1.2em;"></i>
                    </button>
                }
                else
                {
                    <button data-post="@Model.Id" class="btn-unsave-post" style="background-color: transparent; border: none; padding: 10px; border-radius: 5px; font-size: 1em; cursor: pointer; color: inherit;" title="Bỏ lưu bài đăng">
                        <i class="fa fa-bookmark" style="font-size: 1.2em;  color: #0078D4;"></i>
                    </button>
                }
                }
            </div>

            <div class="skills-section" style="margin-bottom: 20px;">
            <p class="post-content" style="margin: 0 0 15px;">@Html.Raw(Model.Content)</p>

                @{
                    if (Model.ImageUrl != null && Model.ImageUrl != "")
                    {
                        <img src=@( $"/Image/{Model.ImageUrl}") alt="Post Image" class="post-image" style="max-width: 50%; height: auto; margin-bottom: 15px; border-radius: 8px;">

                    }
                }
            </div>
            <hr />
        <div class="post-footer" style="display: flex; align-items: center; color: #555; font-size: 0.9em;">
            <span style="display: flex; gap: 20px;">
                <span id="container-number-like-@Model.Id">
                    @{
                        if (!ViewBag.LikePost.Contains(Model.Id))
                        {
                            <span data-post="@Model.Id" style="cursor: pointer;" class="like">
                                <i class="fa fa-thumbs-up"></i> <span id="number-like-@Model.Id" class="likes-count">@Model.LikeNumber</span>
                            </span>
                        }
                        else
                        {
                            <span data-post="@Model.Id" style="cursor: pointer; color: #0078D4;" class="unlike">
                                <i class="fa fa-thumbs-up"></i> <span id="number-like-@Model.Id" class="likes-count">@Model.LikeNumber</span>
                            </span>
                        }
                    }
                </span>
                <span class="comments" data-post="@Model.Id" style="cursor: pointer;">
                    <i class="fa fa-comment"></i> <span class="comments-count" id="number-comment-@Model.Id">@Model.CommentNumber</span>
                </span>
            </span>
        </div>

        <!-- Container for comments -->
        <div id="comments-container-@Model.Id" class="comments-container" style="display: none; padding: 15px;">
            <!-- Comments will be loaded here -->
        </div>
        </div>

</div>

@section script {
    <script>
        btnSavePost();
        btnUnSavePost();
        btnLikePost();
        btnUnLikePost();
        function btnSavePost() {
            $('.btn-save-post').on('click', function (event) {
                event.preventDefault(); // Ngăn hành động mặc định
                //  alert('ok');
                var newId = $(this).data("post");


                $.ajax({
                    url: '/Community/SavePost',
                    type: 'POST',
                    data: {
                        postId: newId
                    },
                    success: function (response) {
                        showSuccess('Lưu bài đăng thành công.');
                        var container = $(`#container-btn-post-${newId}`);
                        var html = `
                                                             <button data-post="${newId}" class="btn-unsave-post" style="background-color: transparent; border: none; padding: 10px; border-radius: 5px; font-size: 1em; cursor: pointer; color: inherit;" title="Bỏ lưu bài đăng">
                                                                        <i class="fa fa-bookmark" style="font-size: 1.2em;  color: #0078D4;"></i>
                                                            </button>
                                    `;
                        container.html(html);
                        btnUnSavePost();
                    },
                    error: function (xhr, status, error) {
                        showError('Hãy đăng nhập');
                    }
                });
            });
        }

        function btnUnSavePost() {
            $('.btn-unsave-post').on('click', function (event) {
                event.preventDefault(); // Ngăn hành động mặc định
                //  alert('ok');
                var newId = $(this).data("post");


                $.ajax({
                    url: '/Community/UnSavePost',
                    type: 'POST',
                    data: {
                        postId: newId
                    },
                    success: function (response) {
                        showSuccess('Bỏ lưu bài đăng thành công.');
                        var container = $(`#container-btn-post-${newId}`);
                        var html = `
                                                                <button data-post="${newId}" class="btn-save-post" style="background-color: transparent; border: none; padding: 10px; border-radius: 5px; font-size: 1em; cursor: pointer; color: inherit;" title="Lưu bài đăng">
                                                                    <i class="fa fa-bookmark" style="font-size: 1.2em;"></i>
                                                                </button>
                                            `;
                        container.html(html);
                        btnSavePost();
                    },
                    error: function (xhr, status, error) {
                        showError('Hãy đăng nhập');
                    }
                });
            });
        }

        function btnLikePost() {
            $('.like').on('click', function (event) {
                event.preventDefault(); // Ngăn hành động mặc định
                //  alert('ok');
                var newId = $(this).data("post");
                //   alert(newId);

                $.ajax({
                    url: '/Community/LikePost',
                    type: 'POST',
                    data: {
                        postId: newId
                    },
                    success: function (response) {
                        var container = $(`#container-number-like-${newId}`);
                        var numberLike = parseInt($(`#number-like-${newId}`).text())
                        numberLike++;
                        var html = `
                                                                                     <span data-post="${newId}" style="cursor: pointer; color: #0078D4;" class="unlike">
                                                                                <i class="fa fa-thumbs-up"></i> <span id="number-like-${newId}" class="likes-count">${numberLike}</span>
                                                            </span>
                                            `;
                        container.html(html);
                        btnUnLikePost();
                    },
                    error: function (xhr, status, error) {
                        showError('Hãy đăng nhập');
                    }
                });
            });
        }

        function btnUnLikePost() {
            $('.unlike').on('click', function (event) {
                event.preventDefault(); // Ngăn hành động mặc định
                //  alert('ok');
                var newId = $(this).data("post");
                //   alert(newId);

                $.ajax({
                    url: '/Community/UnLikePost',
                    type: 'POST',
                    data: {
                        postId: newId
                    },
                    success: function (response) {
                        var container = $(`#container-number-like-${newId}`);
                        var numberLike = parseInt($(`#number-like-${newId}`).text())
                        numberLike--;
                        var html = `
                                                                                                     <span data-post="${newId}" style="cursor: pointer;" class="like">
                                                                                <i class="fa fa-thumbs-up"></i> <span id="number-like-${newId}" class="likes-count">${numberLike}</span>
                                                            </span>
                                                    `;
                        container.html(html);
                        btnLikePost();
                    },
                    error: function (xhr, status, error) {
                        showError('Hãy đăng nhập');
                    }
                });
            });
        }

        function TitleBtnLikePost() {
            $('.title-like').on('click', function (event) {
                event.preventDefault(); // Ngăn hành động mặc định
                //   alert('ok');
                var newId = $(this).data("post");
                var newCommentId = $(this).data("comment-id");
                // alert(newId);

                $.ajax({
                    url: '/Community/LikePost',
                    type: 'POST',
                    data: {
                        postId: newId
                    },
                    success: function (response) {
                        var container = $(`#title-container-number-like-${newCommentId}`);
                        var numberLike = parseInt($(`#title-number-like-${newCommentId}`).text())
                        numberLike++;
                        var html = `
                                                                                                                                            <span data-post="${newId} data-comment-id="${newCommentId} style="cursor: pointer;" class="title-unlike">
                                                                                                                        <i class="fa fa-thumbs-up"></i> <span id="title-number-like-${newCommentId}" class="likes-count">${numberLike}</span>
                                                                            </span>
                                                       </span>
                                                    `;
                        container.html(html);
                        btnUnLikePost();
                    },
                    error: function (xhr, status, error) {
                        showError('Hãy đăng nhập');
                    }
                });
            });
        }

        function TitleBtnUnLikePost() {
            $('.unlike').on('click', function (event) {
                event.preventDefault(); // Ngăn hành động mặc định
                //  alert('ok');
                var newId = $(this).data("post");
                var newCommentId = $(this).data("comment-id");
                //   alert(newId);

                $.ajax({
                    url: '/Community/UnLikePost',
                    type: 'POST',
                    data: {
                        postId: newId
                    },
                    success: function (response) {
                        var container = $(`#title-container-number-like-${newCommentId}`);
                        var numberLike = parseInt($(`#title-number-like-${newCommentId}`).text())
                        numberLike--;
                        var html = `
                                                                                                             <span data-post="${newId}" style="cursor: pointer;" class="like">
                                                                                        <i class="fa fa-thumbs-up"></i> <span id="number-like-${newId}" class="likes-count">${numberLike}</span>
                                                                    </span>
                                                            `;
                        container.html(html);
                        // btnLikePost();
                    },
                    error: function (xhr, status, error) {
                        showError('Hãy đăng nhập');
                    }
                });
            });
        }

        $('.btn-delete-post').on('click', function (event) {
            event.preventDefault(); // Ngăn hành động mặc định
            //  alert('ok');
            var newId = $(this).data("post");


            $.ajax({
                url: '/Community/DeletePost',
                type: 'POST',
                data: {
                    id: newId
                },
                success: function (response) {
                    showSuccess('Xóa bài đăng thành công.');
                    var container = document.getElementById(`container-post-${newId}`);
                    if (container) {
                        container.remove();
                    }
                },
                error: function (xhr, status, error) {
                    showError('Hãy đăng nhập');
                }
            });
        });

        $('.btn-edit-post').on('click', function (event) {
            event.preventDefault(); // Ngăn hành động mặc định
            //  alert('ok');
            var newId = $(this).data("post");
            window.location.replace(`/chinh-bai-dang/${newId}`)
        });

        // Event handler for submitting a new comment
        $('.comments-container').on('click', '.btn-submit-comment', function () {
            var postId = $(this).data('post');
            var newComment = $(`#new-comment-${postId}`).val();

            if (newComment.trim() !== "") {
                // Send the comment via AJAX
                /* $.ajax({
                     url: '/Community/AddComment',
                     type: 'POST',
                     data: { postId: postId, content: newComment },
                     success: function (response) {
                         showSuccess('Bình luận đã được thêm.');
                         // Optionally, append the new comment to the list of comments
                     },
                     error: function (xhr, status, error) {
                         showError('Vui lòng đăng nhập.');
                     }
                 });*/
            } else {
                alert('Nội dung bình luận không được để trống.');
            }
        });



        $('.comments').on('click', function (event) {
            event.preventDefault();
            var postId = $(this).data('post');
            var commentsContainer = $(`#comments-container-${postId}`);

            // Check if comments are already loaded and visible
            if (commentsContainer.is(':visible')) {
                commentsContainer.slideUp(); // Hide comments if already visible
            } else {



                // Load comments via AJAX
                $.ajax({
                    url: '/Comment/GetCommentOfPost', // API to get comments
                    type: 'POST',
                    data: { postId: postId },
                    success: function (comments) {
                        console.log(comments);
                        commentsContainer.empty();

                        comments.forEach(function (comment) {
                            // Render comments
                            var commentHtml = `
                                <div class="comment" style="padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                    <div style="display: flex; align-items: center;">
                                        <img src="${comment.imageUrl != null && comment.imageUrl != '' ? `/Image/${comment.imageUrl}` : "/images/default-avatar.jpg"}" alt="Avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
                                        <div>
                                            <span style="font-weight: bold;">${comment.lastName} ${comment.firstName}</span>
                                            <span style="color: gray; font-size: 0.9em;">20 giờ trước</span>
                                        </div>
                                    </div>
                                    <p style="margin: 10px 0;">${comment.content}</p>
                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                        <!-- Nút Thích -->
                                        <!-- Hiển thị số lượt thích -->
                                                 <span style="display: flex; gap: 20px;">
                                                         <span id="title-container-number-like-${comment.id}">
                                                                                            <span data-post="${comment.postId}" data-comment-id="${comment.id} style="cursor: pointer;" class="title-like">
                                                                                                <i class="fa fa-thumbs-up"></i> <span id="title-number-like-${comment.id}" class="likes-count">${comment.likeNumber}</span>
                                                                    </span>
                                               </span>

                                        <!-- Liên kết Trả lời -->
                                                                                                <a href="javascript:void(0);" class="reply-link" data-name="${comment.lastName} ${comment.firstName}" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">Trả lời</a>
                                                                 <a href="javascript:void(0);" class="view-reply" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">${comment.replyNumber} luợt phản hồi</a>
                                    </div>

                                    <div class="replies" id="replies-container-${comment.id}" style="margin-left: 40px; padding-top: 10px;">
                                        <!-- Replies will be loaded here -->
                                    </div>
                                </div>
                            `;

                            commentsContainer.append(commentHtml);
                        });
                        TitleBtnLikePost();
                        // Append input form for adding a new comment
                        var commentFormHtml = `
                            <div id="container-comment-input-${postId}">
                                <div class="comment-input-form" style="
                                position: sticky;
                                bottom: 0;
                                background-color: white;
                                padding: 10px;
                                width: 100%;
                                z-index: 10;
                                border-top: 1px solid #ddd;">

                                <input type="text" id="new-comment-${postId}" placeholder="Nhập bình luận của bạn..." style="
                                    width: 100%;
                                    padding: 10px;
                                    border: 1px solid #ddd;
                                    border-radius: 5px;">

                                <button class="btn-submit-comment" data-post="${postId}" style="
                                    margin-top: 10px;
                                    padding: 10px 20px;
                                    background-color: #0078D4;
                                    color: #fff;
                                    border: none;
                                    border-radius: 5px;">
                                    Gửi bình luận
                                </button>
                            </div>
                    </div>
                `;
                        commentsContainer.append(commentFormHtml);

                        // Show comments
                        commentsContainer.slideDown();
                        btnLikePost();
                        btnUnLikePost();
                    },
                    error: function (xhr, status, error) {
                        console.error('Failed to load comments:', error);
                    }
                });
            }
        });

        $('.comments-container').on('click', '.view-reply', function () {

            var commentId = $(this).data('comment-id');
            var postId = $(this).data('post');
            var repliesContainer = $(`#replies-container-${commentId}`);

            $.ajax({
                url: '/Comment/GetCommentOfParent', // API to get comments
                type: 'POST',
                data: { parent: commentId },
                success: function (comments) {
                    console.log(comments);
                    var commentHtml = ``;
                    comments.forEach(function (comment) {
                        // Render comments
                        commentHtml += `
                                                         <div class="reply" style="padding: 10px; margin-bottom: 10px; border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
                                                                    <div style="display: flex; align-items: center;">
                                                                                        <img src="${comment.imageUrl != null && comment.imageUrl != '' ? `/Image/${comment.imageUrl}` : "/images/default-avatar.jpg"}" alt="Avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
                                                                        <div>
                                                                                    <span style="font-weight: bold;">${comment.lastName} ${comment.firstName}</span>
                                                                            <span style="color: gray; font-size: 0.9em;">Vừa xong</span>
                                                                        </div>
                                                                    </div>
                                                                                    <p style="margin: 10px 0;">${comment.content}</p>
                                                                                             <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                                <!-- Nút Thích -->
                                                <!-- Hiển thị số lượt thích -->
                                                         <span style="display: flex; gap: 20px;">
                                                                 <span id="title-container-number-like-${comment.id}">
                                                                                                    <span data-post="${comment.postId}" data-comment-id="${comment.id} style="cursor: pointer;" class="title-like">
                                                                                                        <i class="fa fa-thumbs-up"></i> <span id="title-number-like-${comment.id}" class="likes-count">${comment.likeNumber}</span>
                                                                            </span>
                                                       </span>

                                                <!-- Liên kết Trả lời -->
                                                                                                        <a href="javascript:void(0);" class="reply-link" data-name="${comment.lastName} ${comment.firstName}" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">Trả lời</a>
                                                                         <a href="javascript:void(0);" class="view-reply" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">${comment.replyNumber} luợt phản hồi</a>
                                            </div>
                                                                        <div class="title-reply-container-${comment.id}" style="margin-top: 10px; display: none;" id="reply-input-container-${comment.id}">

                                                                        </div>
                                                                </div>
                                            `;




                    });
                    repliesContainer.html(commentHtml);
                },
                error: function (xhr, status, error) {
                    console.error('Failed to load comments:', error);
                }
            });


        });

        $('.comments-container').on('click', '.reply-link', function () {

            var commentId = $(this).data('comment-id');
            var postId = $(this).data('post');

            var repliesContainer = $(`#replies-container-${commentId}`);
            $.ajax({
                url: '/Comment/GetCommentOfParent', // API to get comments
                type: 'POST',
                data: { parent: commentId },
                success: function (comments) {
                    console.log(comments);
                    var commentHtml = ``;
                    comments.forEach(function (comment) {
                        // Render comments
                        commentHtml += `
                                                         <div class="reply" style="padding: 10px; margin-bottom: 10px; border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
                                                                    <div style="display: flex; align-items: center;">
                                                                                        <img src="${comment.imageUrl != null && comment.imageUrl != '' ? `/Image/${comment.imageUrl}` : "/images/default-avatar.jpg"}" alt="Avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
                                                                        <div>
                                                                                    <span style="font-weight: bold;">${comment.lastName} ${comment.firstName}</span>
                                                                            <span style="color: gray; font-size: 0.9em;">Vừa xong</span>
                                                                        </div>
                                                                    </div>
                                                                                    <p style="margin: 10px 0;">${comment.content}</p>
                                                                                              <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                                <!-- Nút Thích -->
                                                <!-- Hiển thị số lượt thích -->
                                                         <span style="display: flex; gap: 20px;">
                                                                 <span id="title-container-number-like-${comment.id}">
                                                                                                    <span data-post="${comment.postId}" data-comment-id="${comment.id} style="cursor: pointer;" class="title-like">
                                                                                                        <i class="fa fa-thumbs-up"></i> <span id="title-number-like-${comment.id}" class="likes-count">${comment.likeNumber}</span>
                                                                            </span>
                                                       </span>

                                                <!-- Liên kết Trả lời -->
                                                                                                        <a href="javascript:void(0);" class="reply-link" data-name="${comment.lastName} ${comment.firstName}" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">Trả lời</a>
                                                                         <a href="javascript:void(0);" class="view-reply" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">${comment.replyNumber} luợt phản hồi</a>
                                            </div>
                                                                        <div class="title-reply-container-${comment.id}" style="margin-top: 10px; display: none;" id="reply-input-container-${comment.id}">

                                                                        </div>
                                                                </div>
                                            `;




                    });
                    repliesContainer.html(commentHtml);
                    if (repliesContainer.find('.reply-form').length === 0) {
                        var replyForm = `
                                                  <div class="reply-form" style="display: flex; align-items: center; width: 100%;">
                                                    <input id="new-reply-${commentId}" type="text" placeholder="Nhập nội dung bình luận..."
                                           style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-right: 10px; width: 100%;">
                                            <button id="btn-reply" data-post="${postId}" data-comment-id="${commentId}"
                                            style="padding: 10px 20px; background-color: #0078D4; color: #fff; border: none; border-radius: 5px; cursor: pointer;"
                                            >Gửi</button>
                                </div>

                                        `;
                        repliesContainer.append(replyForm);


                    }
                },
                error: function (xhr, status, error) {
                    console.error('Failed to load comments:', error);
                }
            });


        });

        $(document).on('click', '.btn-submit-comment', function () {
            var postId = $(this).data('post');
            var newComment = $(`#new-comment-${postId}`).val();
            var newFreelancerId = $('#freelancer-id').val();

            alert('ok');
            if (newComment.trim() !== "") {
                // Send comment via AJAX (implement this for real functionality)
                $.ajax({
                    url: '/Comment/CreateComment',
                    type: 'POST',
                    data: { postId: postId, content: newComment, freelancerId: newFreelancerId },
                    success: function (response) {
                        var newCommentHtml = `
                                                                <div class="comment" style="padding: 10px; margin-bottom: 10px;border: 1px solid #ddd; border-radius: 5px;">
                                                            <div style="display: flex; align-items: center;">
                                                                        <img src="${response != null && response != '' ? `/Image/${response}` : `/images/default-avatar.jpg`}" alt="Avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
                                                                <div>
                                                                    <span style="font-weight: bold;">Tôi</span>
                                                                    <span style="color: gray; font-size: 0.9em;">Vừa xong</span>
                                                                </div>
                                                            </div>
                                                            <p style="margin: 10px 0;">${newComment}</p>
                                                                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                                <!-- Nút Thích -->
                                                <!-- Hiển thị số lượt thích -->
                                                         <span style="display: flex; gap: 20px;">
                                                                 <span id="title-container-number-like-${comment.id}">
                                                                                                    <span data-post="${comment.postId}" data-comment-id="${comment.id} style="cursor: pointer;" class="title-like">
                                                                                                        <i class="fa fa-thumbs-up"></i> <span id="title-number-like-${comment.id}" class="likes-count">${comment.likeNumber}</span>
                                                                            </span>
                                                       </span>

                                                <!-- Liên kết Trả lời -->
                                                                                                        <a href="javascript:void(0);" class="reply-link" data-name="${comment.lastName} ${comment.firstName}" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">Trả lời</a>
                                                                         <a href="javascript:void(0);" class="view-reply" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">${comment.replyNumber} luợt phản hồi</a>
                                            </div>
                                                            <div class="replies" id="replies-container-${/*response.commentId*/5}" style="margin-left: 40px; padding-top: 10px;"></div>
                                                        </div>`;

                        $(`#comments-container-${postId}`).prepend(newCommentHtml);
                        $(`#new-comment-${postId}`).val(''); // Clear the comment input
                        var numberComment = parseInt($(`#number-comment-${postId}`).text());
                        numberComment++;
                        $(`#number-comment-${postId}`).text(numberComment);
                    },
                    error: function (xhr, status, error) {
                        showError('Đã có lỗi xảy ra, vui lòng thử lại sau')
                    }
                });
            }
        });

        $(document).on('click', '#btn-reply', function () {
            //  alert('ok');

            var postId = $(this).data('post');
            var commentId = $(this).data('comment-id');
            var newComment = $(`#new-reply-${commentId}`).val();
            var newFreelancerId = $('#freelancer-id').val();
            //  alert(`${postId} -  ${commentId} - ${newComment} - ${newFreelancerId}`)
            if (newComment.trim() !== "") {
                // Send comment via AJAX (implement this for real functionality)
                $.ajax({
                    url: '/Comment/CreateComment',
                    type: 'POST',
                    data: { postId: postId, content: newComment, freelancerId: newFreelancerId, parent: commentId },
                    success: function (response) {
                        var newReplyHtml = `
                                                        <div class="reply" style="padding: 10px; margin-bottom: 10px; border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
                                                    <div style="display: flex; align-items: center;">
                                                                <img src="${response != null && response != '' ? `/Image/${response}` : `/images/default-avatar.jpg`}" alt="Avatar" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px;">
                                                        <div>
                                                            <span style="font-weight: bold;">Tôi</span>
                                                            <span style="color: gray; font-size: 0.9em;">Vừa xong</span>
                                                        </div>
                                                    </div>
                                                            <p style="margin: 10px 0;">${newComment}</p>
                                                                             <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                                <!-- Nút Thích -->
                                                <!-- Hiển thị số lượt thích -->
                                                         <span style="display: flex; gap: 20px;">
                                                                 <span id="title-container-number-like-${comment.id}">
                                                                                                    <span data-post="${comment.postId}" data-comment-id="${comment.id} style="cursor: pointer;" class="title-like">
                                                                                                        <i class="fa fa-thumbs-up"></i> <span id="title-number-like-${comment.id}" class="likes-count">${comment.likeNumber}</span>
                                                                            </span>
                                                       </span>

                                                <!-- Liên kết Trả lời -->
                                                                                                        <a href="javascript:void(0);" class="reply-link" data-name="${comment.lastName} ${comment.firstName}" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">Trả lời</a>
                                                                         <a href="javascript:void(0);" class="view-reply" data-post="${postId}" data-comment-id="${comment.id}" style="color: #0078D4; font-size: 0.9em;">${comment.replyNumber} luợt phản hồi</a>
                                            </div>
                                                </div>`;

                        $(`#replies-container-${commentId}`).prepend(newReplyHtml);
                        $(`#new-reply-${commentId}`).val(''); // Clear the reply input
                        $(`#new-comment-${postId}`).val(''); // Clear the comment input
                        var numberComment = parseInt($(`#number-comment-${postId}`).text());
                        numberComment++;
                        $(`#number-comment-${postId}`).text(numberComment);
                    },
                    error: function (xhr, status, error) {
                        showError('Đã có lỗi xảy ra, vui lòng thử lại sau')
                    }
                });
            }
        });


    </script>
}