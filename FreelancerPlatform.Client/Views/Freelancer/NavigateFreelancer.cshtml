@using FreelancerPlatform.Client.Helpers
@model FreelancerPlatform.Client.Models.NavigateFreelancerViewModel

@{
    ViewData["Title"] = "Freelancer tiềm năng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section inforOfFreelancerActive {
    active
}



<input type="hidden" id="navigate-hire-mode" value="@ViewBag.Mode" />
<input type="hidden" id="favorite-item" value="@Model.FavoriteJobs" />

<div style="width: 80%; margin: 20px auto; background-color: #fff; padding: 20px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); border-radius: 8px;">

    <!-- Header with search -->
    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px;">
        <input value="@ViewBag.Keyword" type="text" id="searchKeyword" placeholder="Nhập tên freelancer để tìm kiếm" style="width: 90%; padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px; margin-right: 10px; margin-left: 10px;">
        <button id="btn-search-freelancer" class="btn btn-primary"><i class="fa fa-search" style="color: #fff"></i> Tìm</button>
    </div>

    <!-- Small dropdown positioned on the right side -->
    <div style="display: flex; justify-content: flex-end; margin-bottom: 5px; margin-right: 22px;">
        <select id="sortBy" style="padding: 8px 12px; font-size: 12px; border: 1px solid #ccc; background-color: white; margin-left: 10px;">
            <option value="">--Sắp xếp theo--</option>
            <option value="1">Mức lương theo giờ</option>
            <option value="2">Số sao</option>
            <option value="3">Số hợp đồng</option>
        </select>
    </div>

    <div style="display: flex;">

        <!-- Filter Section -->
        <div style="width: 25%; padding: 20px; border-right: 1px solid #ddd;">
            <!-- Header for List -->
            <!--<div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">Lists</div>-->
            <!--
            <div style="margin-bottom: 20px;">
                <a href="#" style="color: #0078D4; text-decoration: none; font-size: 14px;">+ New List</a>
            </div>
            -->
            <!-- Users section -->
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px;">Người dùng</div>
                <ul style="list-style-type: none; padding-left: 0;">
                    <li style="margin-bottom: 10px;">

                        <span id="span-favorite-mode-router" style="color: #0078D4;"><i class="fa fa-heart"></i></span>
                        <a id="favorite-mode-router" href="#" style="color: #0078D4; text-decoration: none;">Dự án yêu thích</a>
                    </li>
                    <li style="margin-bottom: 10px;">

                        <span style="color: #000;"><i class="fa fa-paper-plane"></i></span>
                        <a id="invite-mode" href="#" style="color: #000; text-decoration: none;">Dự án được mời</a>
                    </li>
                </ul>
            </div>

            <div>
                <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px;">Công việc</div>
                <ul style="list-style-type: none; padding-left: 0;">
                    <li style="margin-bottom: 10px;">

                        <span id="span-job-post-mode-router" style="color: #000;"><i class="fa fa-bookmark"></i></span>
                        <a id="job-post-mode-router" href="#" style="color: #000; text-decoration: none;">Dự án đã ứng tuyển</a>
                    </li>
                    <li style="margin-bottom: 10px;">

                        <span style="color: #000;"><i class="fa fa-briefcase"></i></span>
                        <a id="contract-mode" href="#" style="color: #000; text-decoration: none;">Hợp đồng</a>
                    </li>
                </ul>
            </div>
        </div>


        <!-- Freelancer List Section -->
        <div style="width: 75%; padding: 20px;" id="navigate-hire">
            <div id="favorite-mode">
                @{
                    foreach (var i in Model.FavoriteJobs)
                    {
                        <div data-job-type="@i.JobType" data-salary-type="@i.SalaryType" data-keyword="@(i.Name))" data-min-salary="@i.MinDeal" data-max-salary="@i.MaxDeal" class="freelancer-item" data-skill="@string.Join(",", i.Skills.Select(x => x.Id).ToList())" data-category="@i.Category.Id" style="display: flex; justify-content: space-between; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px; background-color: #fff; position: relative;">
                            <div style="display: flex; flex: 1;">

                                <div style="max-width: 600px; position: relative;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="display: flex; align-items: center;">
                                                <h4 style="margin: 0; font-size: 16px;">@i.Name</h4>
                                                @{
                                                    if (i.IsHiden)
                                                    {
                                                        <span style="font-size: 12px; color: gray; margin-left: 10px;">Đã ẩn</span>

                                                    }
                                                    else
                                                    {
                                                        <span style="font-size: 12px; color: gray; margin-left: 10px;">@((int)((DateTime.Now - i.CreateDay)).TotalDays) ngày trước</span>
                                                    }
                                                }
                                            </div>
                                            <div style="font-size: 12px; display: inline-block; margin-left: 10px;">@i.Category.Name</div>
                                            <div style="font-size: 12px; display: inline-block; margin-left: 10px;">| <i class="fa fa-calendar"></i> @(i.JobType == 1 ? "Ngắn hạn" : "Hằng ngày")</div>
                                            <div style="font-size: 12px; display: inline-block; margin-left: 10px;">| <i class="fa fa-money-bill"></i> @(i.SalaryType == 1 ? "Lương theo giờ" : "Lương một lần")</div>


                                        </div>
                                    </div>
                                    <p style="font-size: 16px; margin: 10px 0;">@(Helper.CutString(i.Description))</p>
                                    <div style="display: flex; flex-wrap: wrap; gap: 5px;">

                                        @{
                                            foreach (var j in i.Skills)
                                            {
                                                <span style="border-radius: 15px; padding: 5px 10px; background-color: #0078D4; color: #fff; font-size: 12px;">@j.Name</span>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>


                            <div id="container-btn-favorite-job-@i.Id" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; border-radius: 5px;">
                                <button data-favorite-job="@i.Id" style="background: none; border: none; cursor: pointer;" title="Đã thêm yêu thích" class="gallery-icon remove-favorite-job">

                                    <i class="fa fa-heart" style="font-size: 24px; color: red; margin: 0 10px;"></i>
                                </button>

                            </div>


                            @{
                                if (i.MaxDeal > 0)
                                {
                                    <div style="position: absolute; top: 15px; right: 15px; font-size: 20px; color: #555;">
                                        @($"{i.MinDeal:N0} - {i.MaxDeal:N0}")
                                    </div>
                                }
                                else
                                {
                                    <div style="position: absolute; top: 15px; right: 15px; font-size: 20px; color: #555;">
                                        @($"{i.MinDeal:N0}")
                                    </div>
                                }
                            }


                            <div style="display: flex; flex-direction: row; gap: 10px; position: absolute; bottom: 15px; right: 15px;">
                                <button style="padding: 8px 15px; background-color: #fff; color: #0078D4; border: solid;  border-width: 1px; border-radius: 5px; border-color: #0078D4; cursor: pointer;">Liên hệ</button>
                                <button style="padding: 8px 15px; background-color: #0078D4; color: #fff; border: none; border-radius: 5px; cursor: pointer;"><a href="~/chi-tiet-du-an/@i.Id">Chi tiết</a></button>
                            </div>
                        </div>

                    }
                }


            </div>
            <div id="job-post-mode">
                @{
                    foreach (var i in Model.JobApplies)
                    {
                        <div data-job-type="@i.JobType" data-salary-type="@i.SalaryType" data-keyword="@(i.Name))" data-min-salary="@i.MinDeal" data-max-salary="@i.MaxDeal" class="freelancer-item" data-skill="@string.Join(",", i.Skills.Select(x => x.Id).ToList())" data-category="@i.Category.Id" style="display: flex; justify-content: space-between; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 5px; background-color: #fff; position: relative;">
                            <div style="display: flex; flex: 1;">

                                <div style="max-width: 600px; position: relative;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="display: flex; align-items: center;">
                                                <h4 style="margin: 0; font-size: 16px;">@i.Name</h4>
                                                @{
                                                    if (i.IsHiden)
                                                    {
                                                        <span style="font-size: 12px; color: gray; margin-left: 10px;">Đã ẩn</span>

                                                    }
                                                    else
                                                    {
                                                        <span style="font-size: 12px; color: gray; margin-left: 10px;">@((int)((DateTime.Now - i.CreateDay)).TotalDays) ngày trước</span>
                                                    }
                                                }
                                            </div>
                                            <div style="font-size: 12px; display: inline-block; margin-left: 10px;">@i.Category.Name</div>
                                            <div style="font-size: 12px; display: inline-block; margin-left: 10px;">| <i class="fa fa-calendar"></i> @(i.JobType == 1 ? "Ngắn hạn" : "Hằng ngày")</div>
                                            <div style="font-size: 12px; display: inline-block; margin-left: 10px;">| <i class="fa fa-money-bill"></i> @(i.SalaryType == 1 ? "Lương theo giờ" : "Lương một lần")</div>


                                        </div>
                                    </div>
                                    <p style="font-size: 16px; margin: 10px 0;">@(Helper.CutString(i.Description))</p>
                                    <div style="display: flex; flex-wrap: wrap; gap: 5px;">

                                        @{
                                            foreach (var j in i.Skills)
                                            {
                                                <span style="border-radius: 15px; padding: 5px 10px; background-color: #0078D4; color: #fff; font-size: 12px;">@j.Name</span>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>


                            <div id="container-btn-favorite-job-@i.Id" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; border-radius: 5px;">
                                @{
                                    if (!ViewBag.FavoriteJobOfFreelancers.Contains(i.Id))
                                    {
                                        <button data-favorite-job="@i.Id" style="background: none; border: none; cursor: pointer;" title="Thêm yêu thích" class="gallery-icon add-favorite-job">

                                            <i class="fa fa-heart" style="font-size: 24px; color: #0078D4; margin: 0 10px;"></i>
                                        </button>
                                    }
                                    else
                                    {
                                        <button data-favorite-job="@i.Id" style="background: none; border: none; cursor: pointer;" title="Đã thêm yêu thích" class="gallery-icon remove-favorite-job">

                                            <i class="fa fa-heart" style="font-size: 24px; color: red; margin: 0 10px;"></i>
                                        </button>
                                    }
                                }

                            </div>


                            @{
                                if (i.MaxDeal > 0)
                                {
                                    <div style="position: absolute; top: 15px; right: 15px; font-size: 20px; color: #555;">
                                        @($"{i.MinDeal:N0} - {i.MaxDeal:N0}")
                                    </div>
                                }
                                else
                                {
                                    <div style="position: absolute; top: 15px; right: 15px; font-size: 20px; color: #555;">
                                        @($"{i.MinDeal:N0}")
                                    </div>
                                }
                            }


                            <div style="display: flex; flex-direction: row; gap: 10px; position: absolute; bottom: 15px; right: 15px;">
                                <button style="padding: 8px 15px; background-color: #fff; color: #0078D4; border: solid;  border-width: 1px; border-radius: 5px; border-color: #0078D4; cursor: pointer;">Liên hệ</button>
                                <button style="padding: 8px 15px; background-color: #0078D4; color: #fff; border: none; border-radius: 5px; cursor: pointer;"><a href="~/chi-tiet-du-an/@i.Id">Chi tiết</a></button>
                            </div>
                        </div>

                    }
                }
            </div>
        </div>

    </div>

</div>

@section script {
    <script>
        $(document).ready(function () {


            initial();
            function initial() {
                $('#favorite-mode').show();
                $('#job-post-mode').hide();
            }

            $('#sortBy').on('change', function () {
                var valueSelect = $('#sortBy').val();
                //alert(valueSelect);
                if (isNaN(valueSelect) || valueSelect == 0) {
                    $('.freelancer-item').show();
                    return;
                }
                var items = $('.freelancer-item').get();
                items.sort(function (a, b) {
                    var salaryA = parseInt($(a).data('salary'));
                    var salaryB = parseInt($(b).data('salary'));

                    if (valueSelect == 1) {
                        return salaryB - salaryA;
                    } /*else if (valueSelect == 2) {
                                        return salaryB - salaryA;
                                    }*/
                });
                $.each(items, function (index, item) {
                    $(item).parent().append(item);
                });

            });

            $('#btn-search-freelancer').on('click', function () {
                filterKeyword();
            });

            function filterKeyword() {
                var value = $('#searchKeyword').val().trim();

                if (value === '') {
                    $('.freelancer-item').show();
                    return;
                }

                $('.freelancer-item').hide();
                $('.freelancer-item').each(function () {
                    var keyword = $(this).data('keyword');
                    if (keyword.toUpperCase().includes(value.toUpperCase())) {
                        $(this).show();
                    }
                });
            }


            $('.add-favorite').on('click', function () {
                var id = $(this).data('favorite-job');

                $.ajax({
                    url: '/Job/AddFavoriteJob',
                    type: 'POST',
                    data: {
                        jobId: id
                    },
                    success: function (response) {
                        showSuccess('Thêm yêu thích thành công.');
                        var container = document.getElementById(`container-btn-potient-${id}`); // Corrected variable name
                        container.innerHTML = `
                                                        <button data-potient="${id}" style="background: none; border: none; cursor: pointer;" title="Đã thêm yêu thích" class="gallery-icon remove-favorite-job">

                                                                        <i class="fa fa-heart" style="font-size: 24px; color: red; margin: 0 10px;"></i>
                                                                </button>
                                    `;
                    },
                    error: function (xhr, status, error) {
                        showError('Hãy đăng nhập');
                    }
                });
            });


            $('.remove-favorite-job').on('click', function () {
                var id = $(this).data('favorite-job');
               
                $.ajax({
                    url: '/Job/MinusFavoriteJob',
                    type: 'POST',
                    data: {
                        jobId: id
                    },
                    success: function (response) {
                        showSuccess('Xóa yêu thích thành công.');
                        var container = document.getElementById(`container-btn-favorite-job-${id}`); // Corrected variable name
                        container.innerHTML = `
                                                                <button data-favorite-job="${id}" style="background: none; border: none; cursor: pointer;" title="Thêm  yêu thích" class="gallery-icon add-favorite-job">

                                                    <i class="fa fa-heart" style="font-size: 24px; color: #0078D4; margin: 0 10px;"></i>
                                        </button>
                                            `;
                    },
                    error: function (err) {
                        showError('Hãy đăng nhập');
                    }
                });
            });


            $('.add-favorite-job').on('click', function () {
                var id = $(this).data('favorite-job');
                //alert(id);
                $.ajax({
                    url: '/Job/AddFavoriteJob',
                    type: 'POST',
                    data: {
                        jobId: id
                    },
                    success: function (response) {
                        showSuccess('Thêm yêu thích thành công.');
                        var container = document.getElementById(`container-btn-favorite-job-${id}`); // Corrected variable name
                        container.innerHTML = `
                                                                        <button data-favorite-job="${id}" style="background: none; border: none; cursor: pointer;" title="Đã thêm yêu thích" class="gallery-icon remove-favorite-job">

                                                            <i class="fa fa-heart" style="font-size: 24px; color: red; margin: 0 10px;"></i>
                                                </button>
                                                    `;
                    },
                    error: function (err) {
                        showError('Hãy đăng nhập');
                    }
                });
            });



            $('#job-post-mode-router').on('click', function () {
                $('#favorite-mode').hide();
                $('#job-post-mode').show();
                var favoriteMode = document.getElementById(`favorite-mode-router`);
                favoriteMode.style.color = "#000"; //0078D4
                var spanFavoriteMode = document.getElementById(`span-favorite-mode-router`);
                spanFavoriteMode.style.color = "#000"; //0078D4

                var postJobMode = document.getElementById(`job-post-mode-router`);
                postJobMode.style.color = "#0078D4"; //0078D4
                var spanPostJobMode = document.getElementById(`span-job-post-mode-router`);
                spanPostJobMode.style.color = "#0078D4"; //0078D4
            });

            $('#favorite-mode-router').on('click', function () {
                $('#favorite-mode').show();
                $('#job-post-mode').hide();

                var favoriteMode = document.getElementById(`favorite-mode-router`);
                favoriteMode.style.color = "#0078D4"; //0078D4
                var spanFavoriteMode = document.getElementById(`span-favorite-mode-router`);
                spanFavoriteMode.style.color = "#0078D4"; //0078D4

                var postJobMode = document.getElementById(`job-post-mode-router`);
                postJobMode.style.color = "#000"; //0078D4
                var spanPostJobMode = document.getElementById(`span-job-post-mode-router`);
                spanPostJobMode.style.color = "#000"; //0078D4
            });

        });
    </script>
}